<prompt>
<system_instructions>
<persona>
      <role>REPAIR_AGENT Specialist</role>
      <domain>CONTROLLER</domain>
      <mission><![CDATA[
  Execute specialized technical duties with artisan-level precision.
      SPECIALIZED MISSION: MISSION: Analyze [ERROR_LOG] and fix the [BROKEN_TEST_CODE].
      TECHNICAL RULES:
      1. FIXED CLASS: Provide the complete, fixed Java class.
      2. FIX TEST ONLY: You MUST ONLY modify the test file provided in [BROKEN_TEST_CODE]. NEVER modify source code entities (e.g., User.java, Product.java, OrderEvent.java).
      3. TEST DATA SETUP: If ConstraintViolationException occurs, the problem is usually in test setup (@BeforeEach). Check if all required entity fields (marked with @NotBlank, @NotNull) are populated in the test data.
      4. NEVER GIVE UP: Even if the code looks corrupted or contains XML tags, extract the Java parts and fix them. ALWAYS provide a valid Java class in <java_class>.
      5. IGNORE XML TAGS: If you see <response>, <thought>, <status>, or <java_class> tags in the input code, ignore them and extract only the actual Java code.
      6. SPRING CONTEXT: If 'NoSuchBeanDefinitionException' for JPAQueryFactory occurs, add @Import(com.example.demo.config.QueryDslConfig.class).
      7. MOCKITO MATCHERS: Never mix matchers (any(), eq()) with raw values. Use eq() for all raw values if matchers are present.
      8. STATIC IMPORTS: Ensure static imports for Mockito ArgumentMatchers are present (any, eq, etc.).
      9. NO HALLUCINATION: Fix only the provided test. Do not invent files or dependencies that don't exist in the context.
      ]]></mission>
      <domain_strategy><![CDATA[
  Global Strategy: Artisan BDD Testing
      - Infrastructure: Latest stable libraries (Java 21, JUnit 5.11, Mockito 5.14, AssertJ 3.26).
      - Structure: Strictly follow @Nested Describe_{MethodName} organization.
      - Pattern: Use // given, // when, // then as mandatory structural anchors.
      - Logic Anchoring: Reuse actual business logic and naming from the provided context tags to ensure context-aware generation.
      - Verification: Ensure 100% logic coverage with meaningful Korean @DisplayName.
      DOMAIN STRATEGY: Strategy: Error-Driven Refactoring
      - Analyze: Read the Compiler Error or Assertion Failure carefully.
      - Fix: Apply minimal, surgical fixes. Do not rewrite logic unless broken.
      - Check Imports: Ensure missing imports are added.
      - Check Annotations: Ensure necessary Spring annotations (@DataJpaTest, @WebMvcTest) are present and configured.
      ]]></domain_strategy>
      <critical_policy><![CDATA[
  1. Path Discovery: Map every logical decision point.
      2. Boundary Hunt: Target Null, Empty, Max/Min, and Invalid formats.
      3. Error Precision: Capture the exact exception type and the specific error message text.
      4. State Consistency: Verify the final state of all objects after execution.
      PLANNING GUIDANCE: Identify the root cause (Syntax, Import, Context Loading, Assertion). Plan the fix.
      1. BDD Style: Write clean given/when/then sections.
      2. Fluent Assertions: Use AssertJ for readable and robust verification.
      3. No Filler: Output raw content (code or text) only inside the designated XML tags.
      - Smart Assertions: Use [FIXME] or [TODO] comments for Suspect implementation flaws identified during decomposition.
      - Precision: Reuse names and logic directly from the source code.
      GENERATION TOOLKIT: Preserve existing setup unless it is the cause of the failure.
      Preserve existing mocks.
      Preserve execution flow.
      Adjust assertions only if they are incorrect relative to the source code.
      MANDATORY RULE: If a method accepts multiple input variations, you MUST use @ParameterizedTest with @CsvSource, @ValueSource, or @EnumSource to ensure exhaustive coverage without redundancy.
      SPECIFIC RULE: Keep existing tests.
      ]]></critical_policy>
      <repair_protocol><![CDATA[
  Repair using strict CONTROLLER standards and valid Java syntax.
      ]]></repair_protocol>
  </persona>
  <format_standard><![CDATA[
Strict XML Response Protocol (NO Markdown, NO backticks):
    1. Use ONLY the tags listed below.
    2. DO NOT use plural tags (e.g., use <thought>, not <thoughts>).
    3. DO NOT use unauthorized tags like <actions>, <plan>, <scenario>, <given>, <when>, or <then>.
    4. If using <code>, provide ONLY PURE JAVA CODE using CDATA for safety. No Markdown inside.
    
    STRUCTURE:
    <response>
      <status>...</status>
      <thought>...</thought>
      <code>...</code>
    </response>
  ]]></format_standard>
</system_instructions>

<request>
    <task>
Fix the compilation or runtime errors in the Test Code. Return the COMPLETE fixed Java class.
    </task>
    <lib>
No library info provided.
    </lib>
    <package><![CDATA[

    ]]></package>
    <imports><![CDATA[

    ]]></imports>
    <references>
<reference>
            <name>BROKEN_TEST_CODE_AND_ERROR_LOG</name>
            <ref_class_structure><![CDATA[
        
            ]]></ref_class_structure>
            <ref_methods><![CDATA[
        BROKEN_TEST_CODE:
                package com.example.demo.presentation;
                
                import com.example.demo.service.ProductService;
                import com.fasterxml.jackson.databind.ObjectMapper;
                import org.junit.jupiter.api.BeforeEach;
                import org.junit.jupiter.api.DisplayName;
                import org.springframework.beans.factory.annotation.Autowired;
                import org.springframework.boot.test.autoconfigure.restdocs.AutoConfigureRestDocs;
                import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
                import org.springframework.boot.test.mock.mockito.MockBean;
                import org.springframework.test.web.servlet.MockMvc;
                import static org.springframework.restdocs.mockmvc.MockMvcRestDocumentation.document;
                import org.junit.jupiter.params.provider.CsvSource;
                import static org.assertj.core.api.Assertions.assertThatThrownBy;
                import static org.mockito.ArgumentMatchers.eq;
                import org.mockito.Mock;
                import org.junit.jupiter.api.Nested;
                import static org.mockito.ArgumentMatchers.any;
                import org.junit.jupiter.api.extension.ExtendWith;
                import static org.mockito.BDDMockito.given;
                import org.junit.jupiter.params.provider.ValueSource;
                import org.mockito.InjectMocks;
                import org.mockito.junit.jupiter.MockitoExtension;
                import static org.mockito.Mockito.verify;
                import org.springframework.restdocs.mockmvc.MockMvcRestDocumentation.document;
                import org.junit.jupiter.api.Test;
                import static org.assertj.core.api.Assertions.assertThat;
                import org.junit.jupiter.params.ParameterizedTest;
                import org.junit.jupiter.params.provider.NullSource;
                
                /**
                 * ProductController API 단위 테스트
                 * - MockMvc를 이용한 컨트롤러 레이어 슬라이스 테스트
                 * - Spring REST Docs를 통한 API 문서화 자동화
                 */
                @WebMvcTest(ProductController.class)
                @AutoConfigureRestDocs
                @DisplayName("ProductController WebMvc 테스트")
                class ProductControllerTest {
                
                    @Autowired
                    protected MockMvc mockMvc;
                
                    @Autowired
                    protected ObjectMapper objectMapper;
                
                    @MockBean
                    protected ProductService productService;
                
                    @BeforeEach
                    void setUp() {
                        // 테스트 수행 전 공통 초기화 로직이 필요한 경우 여기에 작성합니다.
                    }
                
                
                @Nested
                @DisplayName("getAllProducts 메서드는")
                class Describe_getAllProducts {
                
                    @Test
                    @DisplayName("등록된 모든 상품 목록을 조회하면 200 OK와 상품 리스트를 반환한다")
                    void it_returns_all_products_with_200_ok() throws Exception {
                        // given
                        List<ProductResponse> products = List.of(ProductResponse.builder().id(1L).name("테스트 상품 A").price(new BigDecimal("15000")).stockQuantity(100L).build(), ProductResponse.builder().id(2L).name("테스트 상품 B").price(new BigDecimal("25000")).stockQuantity(50L).build());
                        given(productService.getAllProducts()).willReturn(products);
                        // when
                        var response = mockMvc.perform(get("/api/products").accept(MediaType.APPLICATION_JSON));
                        // then
                        response.andExpect(status().isOk()).andExpect(jsonPath("$.length()").value(2)).andExpect(jsonPath("$[0].id").value(1L)).andExpect(jsonPath("$[0].name").value("테스트 상품 A")).andExpect(jsonPath("$[0].price").value(15000)).andExpect(jsonPath("$[1].id").value(2L)).andExpect(jsonPath("$[1].name").value("테스트 상품 B")).andDo(document("product/get-all-success", responseFields(fieldWithPath("[]").description("상품 목록"), fieldWithPath("[].id").description("상품 ID"), fieldWithPath("[].name").description("상품명"), fieldWithPath("[].price").description("가격"), fieldWithPath("[].stockQuantity").description("재고 수량"))));
                    }
                
                    @Test
                    @DisplayName("등록된 상품이 없는 경우 200 OK와 빈 리스트를 반환한다")
                    void it_returns_empty_list_with_200_ok() throws Exception {
                        // given
                        given(productService.getAllProducts()).willReturn(List.of());
                        // when
                        var response = mockMvc.perform(get("/api/products").accept(MediaType.APPLICATION_JSON));
                        // then
                        response.andExpect(status().isOk()).andExpect(jsonPath("$.length()").value(0)).andDo(document("product/get-all-empty"));
                    }
                }
                
                @Nested
                @DisplayName("getDiscountedPriceInUsd 메서드는")
                class Describe_getDiscountedPriceInUsd {
                
                    @Nested
                    @DisplayName("존재하는 상품 ID가 주어지면")
                    class Context_with_existing_id {
                
                        @ParameterizedTest
                        @ValueSource(longs = { 1L, 100L })
                        @DisplayName("할인된 USD 가격과 200 OK를 반환한다")
                        void it_returns_discounted_price_and_200_ok(Long id) throws Exception {
                            // given
                            BigDecimal expectedPrice = new BigDecimal("120.50");
                            given(productService.getDiscountedPriceInUsd(id)).willReturn(expectedPrice);
                            // when
                            var result = mockMvc.perform(get("/api/products/{id}/price/usd", id).contentType(MediaType.APPLICATION_JSON));
                            // then
                            result.andExpect(status().isOk()).andExpect(jsonPath("$").value(expectedPrice.doubleValue())).andDo(document("products/get-discounted-price-success", preprocessResponse(prettyPrint()), pathParameters(parameterWithName("id").description("상품 ID"))));
                        }
                    }
                
                    @Nested
                    @DisplayName("존재하지 않는 상품 ID가 주어지면")
                    class Context_with_non_existing_id {
                
                        @Test
                        @DisplayName("404 Not Found를 반환한다")
                        void it_returns_404_not_found() throws Exception {
                            // given
                            Long id = 999L;
                            given(productService.getDiscountedPriceInUsd(id)).willThrow(new ProductNotFoundException(id));
                            // when
                            var result = mockMvc.perform(get("/api/products/{id}/price/usd", id).contentType(MediaType.APPLICATION_JSON));
                            // then
                            result.andExpect(status().isNotFound()).andDo(document("products/get-discounted-price-not-found", preprocessResponse(prettyPrint()), pathParameters(parameterWithName("id").description("상품 ID"))));
                        }
                    }
                }
                
                }
                
                ERROR_LOG:
                > Task :compileJava UP-TO-DATE
                > Task :processResources NO-SOURCE
                > Task :classes UP-TO-DATE
                
                > Task :compileTestJava FAILED
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:2: error: class, interface, enum, or record expected
                YOLO mode is enabled. All tool calls will be automatically approved.
                ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:4: error: illegal character: '`'
                (Use `node --trace-warnings ...` to show where the warning was created)
                     ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:4: error: illegal character: '`'
                (Use `node --trace-warnings ...` to show where the warning was created)
                                               ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:5: error: illegal character: '`'
                I will start by examining the source code of `ProductController` and `HelloService` in the `sample-projects/demo-app` directory, and then I'll check the content of the corrupted test files to see if any valid code remains.
                                                             ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:5: error: illegal character: '`'
                I will start by examining the source code of `ProductController` and `HelloService` in the `sample-projects/demo-app` directory, and then I'll check the content of the corrupted test files to see if any valid code remains.
                                                                               ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:5: error: illegal character: '`'
                I will start by examining the source code of `ProductController` and `HelloService` in the `sample-projects/demo-app` directory, and then I'll check the content of the corrupted test files to see if any valid code remains.
                                                                                     ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:5: error: illegal character: '`'
                I will start by examining the source code of `ProductController` and `HelloService` in the `sample-projects/demo-app` directory, and then I'll check the content of the corrupted test files to see if any valid code remains.
                                                                                                  ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:5: error: illegal character: '`'
                I will start by examining the source code of `ProductController` and `HelloService` in the `sample-projects/demo-app` directory, and then I'll check the content of the corrupted test files to see if any valid code remains.
                                                                                                           ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:5: error: illegal character: '`'
                I will start by examining the source code of `ProductController` and `HelloService` in the `sample-projects/demo-app` directory, and then I'll check the content of the corrupted test files to see if any valid code remains.
                                                                                                                                    ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:5: error: unclosed character literal
                I will start by examining the source code of `ProductController` and `HelloService` in the `sample-projects/demo-app` directory, and then I'll check the content of the corrupted test files to see if any valid code remains.
                                                                                                                                                           ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:7: error: illegal character: '`'
                I will read the source files `HelloService.java` and `ProductController.java` to understand their logic, and then I will examine the corrupted test files `HelloServiceTest.java` and `ProductControllerTest.java` to see if any valid code can be salvaged.
                                             ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:7: error: illegal character: '`'
                I will read the source files `HelloService.java` and `ProductController.java` to understand their logic, and then I will examine the corrupted test files `HelloServiceTest.java` and `ProductControllerTest.java` to see if any valid code can be salvaged.
                                                               ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:7: error: illegal character: '`'
                I will read the source files `HelloService.java` and `ProductController.java` to understand their logic, and then I will examine the corrupted test files `HelloServiceTest.java` and `ProductControllerTest.java` to see if any valid code can be salvaged.
                                                                     ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:7: error: illegal character: '`'
                I will read the source files `HelloService.java` and `ProductController.java` to understand their logic, and then I will examine the corrupted test files `HelloServiceTest.java` and `ProductControllerTest.java` to see if any valid code can be salvaged.
                                                                                            ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:7: error: illegal character: '`'
                I will read the source files `HelloService.java` and `ProductController.java` to understand their logic, and then I will examine the corrupted test files `HelloServiceTest.java` and `ProductControllerTest.java` to see if any valid code can be salvaged.
                                                                                                                                                                          ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:7: error: illegal character: '`'
                I will read the source files `HelloService.java` and `ProductController.java` to understand their logic, and then I will examine the corrupted test files `HelloServiceTest.java` and `ProductControllerTest.java` to see if any valid code can be salvaged.
                                                                                                                                                                                                ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:7: error: illegal character: '`'
                I will read the source files `HelloService.java` and `ProductController.java` to understand their logic, and then I will examine the corrupted test files `HelloServiceTest.java` and `ProductControllerTest.java` to see if any valid code can be salvaged.
                                                                                                                                                                                                      ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:7: error: illegal character: '`'
                I will read the source files `HelloService.java` and `ProductController.java` to understand their logic, and then I will examine the corrupted test files `HelloServiceTest.java` and `ProductControllerTest.java` to see if any valid code can be salvaged.
                                                                                                                                                                                                                                 ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:9: error: illegal character: '`'
                I will now read the `ProductService.java`, `ProductCreateRequest.java`, and `ProductResponse.java` files to understand their structure and dependencies, which will help me write a comprehensive test for `ProductController`.
                                    ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:9: error: illegal character: '`'
                I will now read the `ProductService.java`, `ProductCreateRequest.java`, and `ProductResponse.java` files to understand their structure and dependencies, which will help me write a comprehensive test for `ProductController`.
                                                        ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:9: error: illegal character: '`'
                I will now read the `ProductService.java`, `ProductCreateRequest.java`, and `ProductResponse.java` files to understand their structure and dependencies, which will help me write a comprehensive test for `ProductController`.
                                                           ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:9: error: illegal character: '`'
                I will now read the `ProductService.java`, `ProductCreateRequest.java`, and `ProductResponse.java` files to understand their structure and dependencies, which will help me write a comprehensive test for `ProductController`.
                                                                                     ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:9: error: illegal character: '`'
                I will now read the `ProductService.java`, `ProductCreateRequest.java`, and `ProductResponse.java` files to understand their structure and dependencies, which will help me write a comprehensive test for `ProductController`.
                                                                                            ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:9: error: illegal character: '`'
                I will now read the `ProductService.java`, `ProductCreateRequest.java`, and `ProductResponse.java` files to understand their structure and dependencies, which will help me write a comprehensive test for `ProductController`.
                                                                                                                 ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:9: error: illegal character: '`'
                I will now read the `ProductService.java`, `ProductCreateRequest.java`, and `ProductResponse.java` files to understand their structure and dependencies, which will help me write a comprehensive test for `ProductController`.
                                                                                                                                                                                                                           ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:9: error: illegal character: '`'
                I will now read the `ProductService.java`, `ProductCreateRequest.java`, and `ProductResponse.java` files to understand their structure and dependencies, which will help me write a comprehensive test for `ProductController`.
                                                                                                                                                                                                                                             ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:11: error: illegal character: '`'
                I will read the `ProductCreateRequest.java`, `ProductResponse.java`, and `ProductService.java` files to understand their contents.
                                ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:11: error: illegal character: '`'
                I will read the `ProductCreateRequest.java`, `ProductResponse.java`, and `ProductService.java` files to understand their contents.
                                                          ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:11: error: illegal character: '`'
                I will read the `ProductCreateRequest.java`, `ProductResponse.java`, and `ProductService.java` files to understand their contents.
                                                             ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:11: error: illegal character: '`'
                I will read the `ProductCreateRequest.java`, `ProductResponse.java`, and `ProductService.java` files to understand their contents.
                                                                                  ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:11: error: illegal character: '`'
                I will read the `ProductCreateRequest.java`, `ProductResponse.java`, and `ProductService.java` files to understand their contents.
                                                                                         ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/ProductControllerTest.java:11: error: illegal character: '`'
                I will read the `ProductCreateRequest.java`, `ProductResponse.java`, and `ProductService.java` files to understand their contents.
                                                                                                             ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/com/example/demo/HelloServiceTest.java:4: error: class, interface, enum, or record expected
                YOLO mode is enabled. All tool calls will be automatically approved.
                ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/com/example/demo/HelloServiceTest.java:6: error: illegal character: '`'
                (Use `node --trace-warnings ...` to show where the warning was created)
                     ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/com/example/demo/HelloServiceTest.java:6: error: illegal character: '`'
                (Use `node --trace-warnings ...` to show where the warning was created)
                                               ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/com/example/demo/HelloServiceTest.java:20: error: unclosed character literal
                    message: 'You have exhausted your capacity on this model. Your quota will reset after 11h28m3s.',
                             ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/com/example/demo/HelloServiceTest.java:20: error: unclosed character literal
                    message: 'You have exhausted your capacity on this model. Your quota will reset after 11h28m3s.',
                                                                                                                   ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/HelloServiceTest.java:2: error: class, interface, enum, or record expected
                YOLO mode is enabled. All tool calls will be automatically approved.
                ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/HelloServiceTest.java:4: error: illegal character: '`'
                (Use `node --trace-warnings ...` to show where the warning was created)
                     ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/HelloServiceTest.java:4: error: illegal character: '`'
                (Use `node --trace-warnings ...` to show where the warning was created)
                                               ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/HelloServiceTest.java:18: error: unclosed character literal
                    message: 'You have exhausted your capacity on this model. Your quota will reset after 12h7m39s.',
                             ^
                /root/test-hae-llama/sample-projects/demo-app/src/test/java/HelloServiceTest.java:18: error: unclosed character literal
                    message: 'You have exhausted your capacity on this model. Your quota will reset after 12h7m39s.',
                                                                                                                   ^
                42 errors
                
                FAILURE: Build failed with an exception.
                
                * What went wrong:
                Execution failed for task ':compileTestJava'.
                > Compilation failed; see the compiler error output for details.
                
                * Try:
                > Run with --info option to get more log output.
                > Run with --scan to get full insights.
                
                BUILD FAILED in 3s
                2 actionable tasks: 1 executed, 1 up-to-date
            ]]></ref_methods>
        </reference>
    </references>
    <class_structure><![CDATA[

    ]]></class_structure>
    <target_method><![CDATA[

    ]]></target_method>

</request>
</prompt>
